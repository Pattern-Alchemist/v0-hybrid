import { NextRequest, NextResponse } from 'next/server'; import { capturePayPalOrder } from '@/lib/paypal'; import { supabase } from '@/lib/supabaseClient'; export async function POST(req: NextRequest){ const { orderID } = await req.json(); const cap = await capturePayPalOrder(orderID); if(cap?.status!=='COMPLETED') return NextResponse.json({ error: 'Not completed' }, { status: 400 }); const { data: order } = await supabase.from('orders').insert({ product:'karmic_snapshot', amount:500, currency:'USD', channel:'paypal', external_id: orderID, status:'paid' }).select().single(); return NextResponse.json({ order_id: order?.id }) }
